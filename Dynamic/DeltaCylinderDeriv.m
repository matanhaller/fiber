% Derivative of determinant of the dielectric cylinder's eigenvalue equation.

function dp = DeltaCylinderDeriv(n, k_z, omega, varepsilon)
    dp = -omega.^2.*((besselk(n+1.0,sqrt(k_z.^2-omega.^2))-n.*1.0./sqrt(k_z.^2-omega.^2).*besselk(n,sqrt(k_z.^2-omega.^2))).*1.0./sqrt(k_z.^2-omega.^2)+(varepsilon.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besselk(n,sqrt(k_z.^2-omega.^2)).*(besseli(n+1.0,sqrt(-omega.^2.*varepsilon+k_z.^2))+n.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))))./besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))).*(1.0./sqrt(k_z.^2-omega.^2).*(k_z.*1.0./sqrt(k_z.^2-omega.^2).*besselk(n,sqrt(k_z.^2-omega.^2))-n.*(k_z.*1.0./sqrt(k_z.^2-omega.^2).*besselk(n+1.0,sqrt(k_z.^2-omega.^2))-(k_z.*n.*besselk(n,sqrt(k_z.^2-omega.^2)))./(k_z.^2-omega.^2)).*1.0./sqrt(k_z.^2-omega.^2)+(k_z.*(n+1.0).*besselk(n+1.0,sqrt(k_z.^2-omega.^2)))./(k_z.^2-omega.^2)-k_z.*n.*1.0./(k_z.^2-omega.^2).^(3.0./2.0).*besselk(n,sqrt(k_z.^2-omega.^2)))+k_z.*(besselk(n+1.0,sqrt(k_z.^2-omega.^2))-n.*1.0./sqrt(k_z.^2-omega.^2).*besselk(n,sqrt(k_z.^2-omega.^2))).*1.0./(k_z.^2-omega.^2).^(3.0./2.0)-(1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besselk(n,sqrt(k_z.^2-omega.^2)).*(n.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*(k_z.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besseli(n+1.0,sqrt(-omega.^2.*varepsilon+k_z.^2))-(k_z.*n.*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2)))./(omega.^2.*varepsilon-k_z.^2))+k_z.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))-k_z.*n.*1.0./(-omega.^2.*varepsilon+k_z.^2).^(3.0./2.0).*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))+(k_z.*besseli(n+1.0,sqrt(-omega.^2.*varepsilon+k_z.^2)).*(n+1.0))./(omega.^2.*varepsilon-k_z.^2)))./besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))+(1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*(k_z.*1.0./sqrt(k_z.^2-omega.^2).*besselk(n+1.0,sqrt(k_z.^2-omega.^2))-(k_z.*n.*besselk(n,sqrt(k_z.^2-omega.^2)))./(k_z.^2-omega.^2)).*(besseli(n+1.0,sqrt(-omega.^2.*varepsilon+k_z.^2))+n.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))))./besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))+(k_z.*1.0./(-omega.^2.*varepsilon+k_z.^2).^(3.0./2.0).*besselk(n,sqrt(k_z.^2-omega.^2)).*(besseli(n+1.0,sqrt(-omega.^2.*varepsilon+k_z.^2))+n.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))))./besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))+1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*(k_z.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besseli(n+1.0,sqrt(-omega.^2.*varepsilon+k_z.^2))-(k_z.*n.*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2)))./(omega.^2.*varepsilon-k_z.^2)).*besselk(n,sqrt(k_z.^2-omega.^2)).*(besseli(n+1.0,sqrt(-omega.^2.*varepsilon+k_z.^2))+n.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))).*1.0./besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2)).^2)-omega.^2.*((besselk(n+1.0,sqrt(k_z.^2-omega.^2))-n.*1.0./sqrt(k_z.^2-omega.^2).*besselk(n,sqrt(k_z.^2-omega.^2))).*1.0./sqrt(k_z.^2-omega.^2)+(1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besselk(n,sqrt(k_z.^2-omega.^2)).*(besseli(n+1.0,sqrt(-omega.^2.*varepsilon+k_z.^2))+n.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))))./besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))).*(1.0./sqrt(k_z.^2-omega.^2).*(k_z.*1.0./sqrt(k_z.^2-omega.^2).*besselk(n,sqrt(k_z.^2-omega.^2))-n.*(k_z.*1.0./sqrt(k_z.^2-omega.^2).*besselk(n+1.0,sqrt(k_z.^2-omega.^2))-(k_z.*n.*besselk(n,sqrt(k_z.^2-omega.^2)))./(k_z.^2-omega.^2)).*1.0./sqrt(k_z.^2-omega.^2)+(k_z.*(n+1.0).*besselk(n+1.0,sqrt(k_z.^2-omega.^2)))./(k_z.^2-omega.^2)-k_z.*n.*1.0./(k_z.^2-omega.^2).^(3.0./2.0).*besselk(n,sqrt(k_z.^2-omega.^2)))+k_z.*(besselk(n+1.0,sqrt(k_z.^2-omega.^2))-n.*1.0./sqrt(k_z.^2-omega.^2).*besselk(n,sqrt(k_z.^2-omega.^2))).*1.0./(k_z.^2-omega.^2).^(3.0./2.0)+(varepsilon.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*(k_z.*1.0./sqrt(k_z.^2-omega.^2).*besselk(n+1.0,sqrt(k_z.^2-omega.^2))-(k_z.*n.*besselk(n,sqrt(k_z.^2-omega.^2)))./(k_z.^2-omega.^2)).*(besseli(n+1.0,sqrt(-omega.^2.*varepsilon+k_z.^2))+n.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))))./besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))-(varepsilon.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besselk(n,sqrt(k_z.^2-omega.^2)).*(n.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*(k_z.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besseli(n+1.0,sqrt(-omega.^2.*varepsilon+k_z.^2))-(k_z.*n.*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2)))./(omega.^2.*varepsilon-k_z.^2))+k_z.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))-k_z.*n.*1.0./(-omega.^2.*varepsilon+k_z.^2).^(3.0./2.0).*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))+(k_z.*besseli(n+1.0,sqrt(-omega.^2.*varepsilon+k_z.^2)).*(n+1.0))./(omega.^2.*varepsilon-k_z.^2)))./besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))+(k_z.*varepsilon.*1.0./(-omega.^2.*varepsilon+k_z.^2).^(3.0./2.0).*besselk(n,sqrt(k_z.^2-omega.^2)).*(besseli(n+1.0,sqrt(-omega.^2.*varepsilon+k_z.^2))+n.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))))./besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))+varepsilon.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*(k_z.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besseli(n+1.0,sqrt(-omega.^2.*varepsilon+k_z.^2))-(k_z.*n.*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2)))./(omega.^2.*varepsilon-k_z.^2)).*besselk(n,sqrt(k_z.^2-omega.^2)).*(besseli(n+1.0,sqrt(-omega.^2.*varepsilon+k_z.^2))+n.*1.0./sqrt(-omega.^2.*varepsilon+k_z.^2).*besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2))).*1.0./besseli(n,sqrt(-omega.^2.*varepsilon+k_z.^2)).^2)-k_z.*n.^2.*besselk(n,sqrt(k_z.^2-omega.^2)).^2.*(1.0./(omega.^2.*varepsilon-k_z.^2)+1.0./(k_z.^2-omega.^2)).^2.*2.0-k_z.^2.*n.^2.*(k_z.*1.0./(omega.^2.*varepsilon-k_z.^2).^2.*2.0-k_z.*1.0./(k_z.^2-omega.^2).^2.*2.0).*besselk(n,sqrt(k_z.^2-omega.^2)).^2.*(1.0./(omega.^2.*varepsilon-k_z.^2)+1.0./(k_z.^2-omega.^2)).*2.0+k_z.^2.*n.^2.*(k_z.*1.0./sqrt(k_z.^2-omega.^2).*besselk(n+1.0,sqrt(k_z.^2-omega.^2))-(k_z.*n.*besselk(n,sqrt(k_z.^2-omega.^2)))./(k_z.^2-omega.^2)).*besselk(n,sqrt(k_z.^2-omega.^2)).*(1.0./(omega.^2.*varepsilon-k_z.^2)+1.0./(k_z.^2-omega.^2)).^2.*2.0;
end